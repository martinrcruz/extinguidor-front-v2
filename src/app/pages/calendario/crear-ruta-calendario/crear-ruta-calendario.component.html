<ion-header>
  <ion-toolbar>
    <ion-title>Crear Ruta</ion-title>
    <ion-buttons  style="color: white !important" slot="start">
      <ion-button style="color: white !important" (click)="cancelar()">Cancelar</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Fecha (read-only) -->
  <ion-item>
    <ion-label position="stacked">Fecha</ion-label>
    <ion-input [(ngModel)]="date" readonly></ion-input>
  </ion-item>

  <!-- Nombre de Ruta (RutaN) -->
  <ion-item>
    <ion-label>Nombre de Ruta</ion-label>
    <ion-select [(ngModel)]="rutaNId" placeholder="Selecciona Nombre Ruta">
      <ion-select-option *ngFor="let rn of rutasN" [value]="rn._id">
        {{ rn.name }}
      </ion-select-option>
    </ion-select>
  </ion-item>

  <!-- Tipo de ruta -->
  <ion-item>
    <ion-label>Tipo de Ruta</ion-label>
    <ion-select [(ngModel)]="type" placeholder="Selecciona un tipo">
      <ion-select-option value="Mantenimiento">Mantenimiento</ion-select-option>
      <ion-select-option value="Correctivo">Correctivo</ion-select-option>
      <ion-select-option value="Visitas">Visitas</ion-select-option>
    </ion-select>
  </ion-item>

  <!-- Estado de la ruta -->
  <ion-item>
    <ion-label>Estado</ion-label>
    <ion-select [(ngModel)]="state" placeholder="Selecciona estado">
      <ion-select-option value="Pendiente">Pendiente</ion-select-option>
      <ion-select-option value="EnProceso">En Proceso</ion-select-option>
      <ion-select-option value="Finalizado">Finalizado</ion-select-option>
    </ion-select>
  </ion-item>

  <!-- Vehículo -->
  <ion-item>
    <ion-label>Vehículo</ion-label>
    <ion-select [(ngModel)]="selectedVehicle" placeholder="Selecciona un Vehículo">
      <ion-select-option 
        *ngFor="let v of vehicles" 
        [value]="v._id"
      >
        {{ v.brand }} {{ v.modelo }} - {{ v.matricula }}
      </ion-select-option>
    </ion-select>
  </ion-item>

   <ion-item>
    <ion-label>Encargado</ion-label>
    <ion-select [(ngModel)]="selectedEncargado" multiple="false" placeholder="Selecciona al encargado">
      <ion-select-option 
        *ngFor="let u of users" 
        [value]="u._id"
      >
        {{ u.name }}
      </ion-select-option>
    </ion-select>
  </ion-item>

  <!-- Trabajadores (users) -->
  <ion-item>
    <ion-label>Trabajadores</ion-label>
    <ion-select [(ngModel)]="selectedUsers" multiple="true" placeholder="Selecciona trabajadores">
      <ion-select-option 
        *ngFor="let u of users" 
        [value]="u._id"
      >
        {{ u.name }}
      </ion-select-option>
    </ion-select>
  </ion-item>

  <!-- Herramientas -->
  <ion-item>
    <ion-label>Herramientas</ion-label>
    <ion-select [(ngModel)]="selectedHerramientas" multiple="true" placeholder="Selecciona herramientas">
      <ion-select-option 
        *ngFor="let t of herramientas" 
        [value]="t._id"
      >
        {{ t.name }}
      </ion-select-option>
    </ion-select>
  </ion-item>

  <!-- Comentario -->
  <ion-item>
    <ion-label>Comentario</ion-label>
    <ion-textarea [(ngModel)]="comentario"></ion-textarea>
  </ion-item>

  <!-- Partes No Asignados -->
  <ion-list>
    <ion-list-header>
      <ion-label>Partes No Asignados</ion-label>
    </ion-list-header>
    
    <ion-item *ngFor="let p of partesNoAsignados">
      <!-- Checkbox para seleccionar el parte -->
      <ion-checkbox slot="start" [(ngModel)]="p.selected"></ion-checkbox>
      <ion-label>
        <h4>{{ p.description }}</h4>
        <p class="parte-details">
          <ion-icon name="cash-outline"></ion-icon>
          {{ p.facturacion }} €
        </p>
        <p class="parte-details">
          <ion-icon name="construct-outline"></ion-icon>
          {{ p.type }} - {{ p.categoria }}
        </p>
        <p class="parte-details">
          <ion-icon name="calendar-outline"></ion-icon>
          {{ p.date | date:'dd/MM/yyyy' }}
        </p>
        <p class="parte-details">
          <ion-icon name="business-outline"></ion-icon>
          {{ p.customer.name }}
        </p>
        <p class="parte-details" *ngIf="p.coordinationMethod">
          <ion-icon name="time-outline"></ion-icon>
          {{ p.coordinationMethod }}
        </p>
        <p class="parte-details" *ngIf="p.periodico">
          <ion-icon name="repeat-outline"></ion-icon>
          Periódico
        </p>
      </ion-label>
    </ion-item>

    <!-- Estado vacío -->
    <div class="empty-state" *ngIf="!partesNoAsignados || partesNoAsignados.length === 0">
      <ion-icon name="document-text-outline"></ion-icon>
      <h3>No hay partes sin asignar</h3>
      <p>No se encontraron partes pendientes de asignación.</p>
    </div>
  </ion-list>

  <!-- Botón para crear la ruta -->
  <ion-button 
    expand="full" 
    class="ion-margin-top" 
    (click)="createRuta()"
  >
    Crear Ruta
  </ion-button>

</ion-content>
