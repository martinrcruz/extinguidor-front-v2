<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Detalle Ruta</ion-title>
  </ion-toolbar>
</ion-header>

<!-- <div class="breadcrumb">
  <ion-icon name="home-outline" color="gray"></ion-icon>
  <span>/</span>
  <span>Detalle Ruta</span>
</div> -->

<ion-content>
  <ion-segment [(ngModel)]="tabSelected" (ionChange)="seleccionarTab($event.detail.value)">
    <ion-segment-button value="detalles">
      <ion-label>Detalles</ion-label>
    </ion-segment-button>
    <ion-segment-button value="materiales">
      <ion-label>Materiales</ion-label>
    </ion-segment-button>
    <ion-segment-button value="partes">
      <ion-label>Partes</ion-label>
    </ion-segment-button>
    <ion-segment-button value="facturacion">
      <ion-label>Facturación</ion-label>
    </ion-segment-button>
  </ion-segment>

  <!-- DETALLES -->
  <div *ngIf="tabSelected === 'detalles'">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Ruta: {{ ruta?.name?.name }}</ion-card-title>
        <ion-card-subtitle>Fecha: {{ ruta?.date }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <p>Vehículo: {{ ruta?.vehicle?.brand }} - {{ ruta?.vehicle?.matricula }}</p>
        <p>Trabajadores: 
          <span *ngFor="let u of ruta?.users">{{ u.name }} </span>
        </p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- MATERIALES -->
  <div *ngIf="tabSelected === 'materiales'">
    <ion-button size="small" (click)="agregarMaterial()">
      <ion-icon name="add-outline" slot="icon-only"></ion-icon>
      Agregar Material
    </ion-button>
    <ion-list *ngIf="materiales && materiales.length > 0">
      <ion-item *ngFor="let m of materiales">
        <ion-label>
          <h2>{{ m.name }}</h2>
          <p>Código: {{ m.code }}</p>
        </ion-label>
      </ion-item>
    </ion-list>
    <ion-card *ngIf="!materiales || materiales.length === 0">
      <ion-card-content>
        <p>No hay materiales asignados a esta ruta.</p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- PARTES -->
  <div *ngIf="tabSelected === 'partes'">
    <ion-button size="small" (click)="agregarParte()">
      <ion-icon name="add-outline" slot="icon-only"></ion-icon>
      Agregar Parte
    </ion-button>
    <ion-list *ngIf="partesAsignados && partesAsignados.length > 0">
      <ion-item *ngFor="let p of partesAsignados">
        <ion-label>
          <h2>{{ p.title || p.description }}</h2>
          <p>Estado: {{ p.state }}</p>
          <p *ngIf="p.description">Descripción: {{ p.description }}</p>
        </ion-label>
      </ion-item>
    </ion-list>
    <ion-card *ngIf="!partesAsignados || partesAsignados.length === 0">
      <ion-card-content>
        <p>No hay partes asignados a esta ruta.</p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- FACTURACIÓN -->
  <div *ngIf="tabSelected === 'facturacion'">
    <ion-list>
      <ion-item *ngFor="let f of facturaciones">
        <ion-label>
          <h2>Facturación: {{ f.facturacion }} €</h2>
          <p>Fecha: {{ f.createdDate }}</p>
        </ion-label>
      </ion-item>
    </ion-list>
  </div>
</ion-content>
