<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ isEdit ? 'Editar Ruta' : 'Nueva Ruta' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-container">
    <div class="header">
      <h1>{{ isEdit ? 'Editar Ruta' : 'Nueva Ruta' }}</h1>
    </div>

    <form [formGroup]="rutaForm" (ngSubmit)="onSave()" class="form-container">
      <div class="form-section">
        <h2>Información Básica</h2>
        <ion-item>
          <ion-label position="stacked">Fecha</ion-label>
          <ion-datetime 
            formControlName="date" 
            display-format="yyyy-MM-dd" 
            picker-format="yyyy-MM-dd"
            class="datetime-custom"
            placeholder="Seleccione fecha">
          </ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Ruta</ion-label>
          <ion-select formControlName="name" placeholder="Seleccione una ruta">
            <ion-select-option *ngFor="let rn of listaRutaN" [value]="rn.id || rn._id">
              {{ rn.name }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Estado</ion-label>
          <ion-select formControlName="state" placeholder="Seleccione estado">
            <ion-select-option value="Pendiente">Pendiente</ion-select-option>
            <ion-select-option value="EnProceso">En Proceso</ion-select-option>
            <ion-select-option value="Finalizado">Finalizado</ion-select-option>
          </ion-select>
        </ion-item>
      </div>

      <div class="form-section">
        <h2>Vehículos y Personal</h2>
        <ion-item>
          <ion-label position="stacked">Vehículo</ion-label>
          <ion-select formControlName="vehicle" placeholder="Seleccione vehículo">
            <ion-select-option *ngFor="let v of listaVehicles" [value]="v.id || v._id">
              {{ v.brand }} - {{ v.matricula }}
            </ion-select-option>
          </ion-select>
        </ion-item>
        
        <ion-item>
          <ion-label position="stacked">Encargado</ion-label>
          <ion-select formControlName="encargado" placeholder="Seleccione encargado">
            <ion-select-option *ngFor="let u of users" [value]="u.id || u._id">
              {{ u.name }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- Trabajadores -->
        <ion-item>
          <ion-label position="stacked">Trabajadores</ion-label>
          <ion-select formControlName="users" multiple="true" placeholder="Seleccione trabajadores">
            <ion-select-option *ngFor="let user of users" [value]="user.id || user._id">
              {{ user.name }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <!-- <ion-item>
          <ion-label position="stacked">Clientes</ion-label>
          <ion-select formControlName="clientes" multiple="true" placeholder="Seleccione un cliente">
            <ion-select-option *ngFor="let cliente of listaClientes" [value]="cliente._id">
              {{ cliente.name }}
            </ion-select-option>
          </ion-select>
        </ion-item> -->
      </div>

      <div class="form-section">
        <h2>Detalles Adicionales</h2>
        <ion-item>
          <ion-label position="stacked">Herramientas/Materiales</ion-label>
          <ion-select formControlName="herramientas" multiple="true" placeholder="Seleccione herramientas">
            <ion-select-option *ngFor="let material of listaMateriales" [value]="material.id || material._id">
              {{ material.name }} ({{ material.code }})
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Comentarios</ion-label>
          <ion-textarea 
            formControlName="comentarios" 
            rows="4"
            placeholder="Añada comentarios o instrucciones adicionales">
          </ion-textarea>
        </ion-item>
      </div>

      <div class="form-actions">
        <ion-button expand="block" type="submit" [disabled]="rutaForm.invalid">
          {{ isEdit ? 'Actualizar' : 'Crear' }}
        </ion-button>
        <ion-button expand="block" fill="outline" (click)="cancel()">
          Cancelar
        </ion-button>
      </div>
    </form>
  </div>
</ion-content>
