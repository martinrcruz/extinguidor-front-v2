<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Facturación</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/facturacion/create">
        <ion-icon name="add-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-container">
    <div class="header">
      <h1>Facturación</h1>
    </div>

    <!-- Resumen -->
    <div class="summary-card">
      <ion-card>
        <ion-card-header>
          <ion-card-title>Resumen</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="summary-item">
            <span>Total facturado:</span>
            <span class="amount">{{ formatCurrency(totalFacturado) }}</span>
          </div>
          <div class="summary-item">
            <span>Número de facturaciones:</span>
            <span class="count">{{ facturaciones.length }}</span>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Lista de Facturaciones -->
    <div class="facturacion-list">
      <div *ngIf="facturaciones.length > 0; else emptyState">
        <ion-card class="facturacion-card" *ngFor="let f of facturaciones">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="document-text-outline"></ion-icon>
              Facturación #{{ getFacturacionId(f) }}
            </ion-card-title>
            <ion-card-subtitle>
              <ion-icon name="calendar-outline"></ion-icon>
              {{ formatDate(f.createdDate) }}
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <div class="facturacion-info">
              <span class="monto">{{ formatCurrency(f.facturacion) }}</span>
              <span class="fecha">{{ formatDate(f.createdDate) }}</span>
            </div>
            
            <div class="ruta-info" *ngIf="f.ruta">
              <ion-icon name="map-outline"></ion-icon>
              <span>{{ getRutaName(f.ruta) || 'Sin ruta asignada' }}</span>
            </div>
            
            <div class="parte-info" *ngIf="f.parte">
              <ion-icon name="document-outline"></ion-icon>
              <span>{{ getParteDescription(f.parte) || 'Sin parte asignado' }}</span>
            </div>
            
            <div class="facturacion-actions">
              <ion-button fill="outline" [routerLink]="['/facturacion/edit', getFacturacionId(f)]">
                <ion-icon name="create-outline" slot="start"></ion-icon>
                Editar
              </ion-button>
              <ion-button color="danger" (click)="eliminarFactura(getFacturacionId(f))">
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                Eliminar
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <ng-template #emptyState>
        <div class="empty-state">
          <ion-icon name="receipt-outline"></ion-icon>
          <h3>No hay facturaciones</h3>
          <p>No se encontraron facturaciones</p>
        </div>
      </ng-template>
    </div>
  </div>
</ion-content> 